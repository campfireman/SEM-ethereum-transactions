\documentclass[runningheads]{llncs}
% Grundgröße 12pt, zweiseitig
% Standardpakete
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
% deutsche Silbentrennung
\usepackage[ngerman]{babel}
\usepackage{amsmath}
\usepackage{cite}

% Grafiken einbinden
\usepackage{graphicx}
\graphicspath{{images/}}

\usepackage{hyperref}
% tiefe des Inhaltsverzeichnisses
\setcounter{tocdepth}{2}

\title{Transaktionen}
\author{Ture Claußen, 1531067, \email{ture.claussen@stud.hs-hannover.de} \and Jannes Neemann, 1530893, \email{jannes.neemann@stud.hs-hannover.de}}
\authorrunning{T. Claußen \and J. Neemann}
\institute{Fakultät IV, Abteilung Informatik, Hochschule Hannover, Ricklinger Stadtweg 120, 30459 Hannover}


% jetzt gehts los
\begin{document}% hier gehts los{\def\addcontentsline#1#2#3{}\maketitle}
{\def\addcontentsline#1#2#3{}\maketitle} % Wird gebraucht, damit der Title nicht im Inhaltsverzeichnis steht




% \begin{center} \sffamily\bfseries Selbständigkeitserklärung \end{center}
% % fett und zentriert in der minipage

% Mit der Abgabe der Ausarbeitung erklären wir, dass wir die eingereichte Seminar-Arbeit
% selbständig und ohne fremde Hilfe verfasst, andere als die von uns angegebenen Quellen
% und Hilfsmittel nicht benutzt und die den benutzten Werken wörtlich oder
% inhaltlich entnommenen Stellen als solche kenntlich gemacht haben.
% \vspace*{7ex}

% Hannover, den \today \hfill



\begin{abstract}
  \keywords{}
\end{abstract}

\tableofcontents  % Inhaltsverzeichnis
%
%
%
\section{Einführung}
% was sind transaktionen im allgemeinen
% was sind transaktionen bei ethereum: Statemaschine
% vergelich zu bitcon
% 
Das Wort Transaktion stammt von dem lateinischen Wort \textit{transigere} ab, welches im übertragenden Sinne mit 'durchführen', 'vollführen' oder 'abmachen' (Geschäft) übersetzt werden kann. \cite{noauthor_transigere_nodate} Dieser Wortsinn besteht auch weiterhin im technischen und wirtschaftlichen Bereich, jedoch gibt es noch spezifischere Abgrenzungen. In der Wirtschaft ist es ein Vorgang bei dem Waren und Forderungen ausgetauscht werden. \cite[S. 18 f.]{ehrlicher_kompendium_1975} In der Informatik ist es im Zusammenhang mit Datenbanken eine unteilbare, \textit{atomare}, Abfolge von Anweisungen, die einen Übergang von einem konsistenten Zustand in einen Anderen beschreibt. \cite[S.520]{herold_grundlagen_2017}

Ethereum ist ein "transaktionsbasierter Automat" (\textit{transaction-based state machine}). Somit sind Transaktionen ein grundlegender Baustein von Ethereum im Allgemeinen und ihnen kommt eine ähnliche Bedeutung wie ACID Transaktionen bei. Der Automat speichert seinen Zuständ $ \sigma_t $ in der Blockchain, eine Transaktion $ T $ ist Argument der Zugstandsübergangsfunktion $ \Upsilon $, die von \textit{externen Akteuren (EA)} angestoßen wird und diesen gespeicherten Zustand $ \sigma_t $ in einen neuen, gültigen Zustand $ \sigma_{t + 1} $ überführen soll: $\sigma_{t+1} = \Upsilon(T, \sigma_t) $. Im Falle eines Konsens des Netzwerkes wird diese Zustandsveränderung durchgeführt beziehungsweise gespeichert.

Im Kontrast zu Kryptowährungen wie Bitcoin ist der Umfang des Automaten bzw. des Protokolls bei Ethereum deutlich geweitet, denn Zweck ist nicht nur die Schöpfung, Speicherung und der Austausch eines digitalen Zahlungsmittels \cite{nakamoto_bitcoin_nodate}, sondern eine allgemeine dezentrale Rechenmaschine, ein "Weltcomputer". Daher bestehen bei Ethereum auch an Transaktionen andere technische und konzeptionelle Anforderungen, die im Folgenden erläutert werden. \cite[S. 1-4]{wood_ethereum/yellowpaper_2019}

\section{Struktur und technische Umsetzung einer Transaktion}
Die Komponenten welche eine Transaktion in Ethereum ausmachen sind vergleichbar mit denen eines Briefes. Sie besitzen einen Empfänger sowie eine Frankierung, welche die Transportkosten zum Empfänger bezahlen. In einen Brief kann man z.B. Geld oder einen Text verschicken. Auch Transaktionen in Ethereum können Geld in Form von Ether und einen Text in Form von Nutzdaten verschicken. Im Weiteren wir die allgemeine Struktur und technische Umsetzung einer Transaktion vorgestellt.

\subsection{Komponenten einer Transaktion}
Transkationen enthalten laut ihrer offiziellen Definition \cite[S. 4]{wood_ethereum/yellowpaper_2019} folgende Datenfelder:
\begin{description}
  \item[nonce:] Ein Skalar welcher gleich der Anzahl der vom EOA versendeten Transaktionen ist. Der Nutzen wird in \ref{nonce} erläutert.
  \item[gasPrice:] Ein Skalar der angibt, wie viel Wei man pro Einheit \textit{Gas} bezahlt, die bei der Gesamtheit aller Berechnungen die während der Ausführung der Transaktion anfallen (S. \ref{gas})
  \item[gasLimit:] Ein Skalar der die maximal Anzahl an \textit{Gas} angibt, die während der Ausführung der Transaktion verbraucht werden darf. Dieser Betrag muss im Voraus bezahlt werden.
  \item[to:] Die 160-Bit Adresse des Empfängers.
  \item[value:] Skalar der die Menge Wei angibt, die der Empfänger erhält.
  \item[v,r,s:] Komponenten der ECDSA-Signatur (S. \ref{ecdsa}), um den Sender der Transaktion zu bestimmen
  \item[init:] Ein Byte-Array unbegrenzter Länge, welches nur bei einer Kontrakterzeugung verwendet wird und den kompilierten Sourcecode des Kontrakts enthält
  \item[data:] Ein Byte-Array unbegrenzter Länge, welches die Nutzdaten des Kontrakts enthält
\end{description}


\subsection{Typen von Transaktionen}
Es gibt genau zwei Typen von Transaktion. Transaktionen die eine Nachricht von einem Account\footnote{Mit Account ist hier ein EOA oder ein Kontrakt gemeint} zu einem anderen überträgt ("`message calls"' \cite[S. 4]{wood_ethereum/yellowpaper_2019}) oder Transaktionen die einen neuen Kontrakt erzeugen ("`contract creation"' \cite[S. 4]{wood_ethereum/yellowpaper_2019})). Mit Nachricht ist dabei der Inhalt von den Feldern \textit{value} und \textit{data} gemeint.

Bei massage call Transaktionen enthält das \textit{to} Feld die öffentliche Adresse eines EOA oder eines Kontrakts. Zusätzlich besteht die Option \textit{value} und \textit{data} zusetzen. Speziell ist das \textit{data} Feld von Bedeutung, wenn das Transaktionsziel ein Kontrakt ist, denn in diesem Feld wird der konkrete
Funktionsaufruf in Bytecode gespeichert und wird von dem Kontrakt ausgeführt.

Die Besonderheit bei contract creation Transaktionen ist, dass die Empfängeradresse die Nulladresse (\textit{0x0}) ist. Diese Adresse ist keinem Account zugewiesen und dient ausschließlich als "`kontrakterzeugungs Adresse"' \cite{antonopoulos_mastering_2019}.

Ein spezieller Typ von Transkation ist eine interne Transaktion. Diese treten nur ausgehend von einem Kontrakt aus auf. Sie werden auch nicht in der Blockchain aufgefasst. Beispielsweise kann eine Transkation die an einen Kontrakt gerichtet ist, eine Funktion aufrufen, welche dem Sender einen Etherbetrag zurücksendet. Diese eigentlich Transaktion wird als interne Transaktion gewertet und nur der Funktionsaufruf wird in der Blockchain dokumentiert.
% Statistik noch hinzufügen
% Ethereumverbrennung

\subsection{Serialisierung}
Da Ethereum ein Weltcomputer ist und Daten somit über die ganze Welt verschickt werden, müssen diese kompakt, effizient und einheitlich verschickt werden. Dabei wird das Kodierungsverfahren \textit{Recursive Length Prefix (RLP)} verwendet.Es ist ein relativ simples und deterministisches Kodierungsverfahren, dessen einzige Aufgabe es ist Struktur zu kodieren. Mit Struktur sind (verschachtelte) Arrays von binären Daten gemeint. Die Methode nimmt dabei genau einen Parameter entgegen ein sogenanntes "`Item"'. % Github RLP Quell
Ein Item ist ist dabei ein String oder eine Liste von Items. Wichtig bei der Kodierung ist die Länge des Inhalts, denn je nach Länge gibt es bestimmte Regeln. In jeder Regel wird spezifiziert, welche zusätzlichen Bytes gesetzt werden. So wird zum Beispiel ein Byte, welches den Wert zwischen \textit{0x00} und \textit{0x7f} hat nicht verändert und das Byte ist das RLP Encoding des Bytes. Ist das Item eine Zeochenlägen mit einer Länge von 0-55 Byte besteht das RLP kodierte Resultat aus dem Byte \textit{0x80} plus die Länge des Strings gefolgt von den Zeichen des Strings. Zum Beispiel würde \textit{Ether} kodiert zu \textit{[0x85, 'E', 't', 'h', 'e', 'r']} werden bzw.  \textit{[0x85, 0x45, 0x74, 0x68, 0x65, 0x72]}, wenn man die Zeichen in ihren ASCII Hex-Code übersetzt.

% Erklärung RLP
\section{Aufbau einer Transaktion}

\subsection{Nonce}
\label{nonce}
\subsection{Gas}
\label{gas}
Gas ist ein zentraler konzeptioneller Lösungsansatz im Rahmen von Ethereum. Da Ethereum turing-vollständig ist \cite[S. 1]{wood_ethereum/yellowpaper_2019}, ergibt sich unter anderem das sogenannte "Halteproblem". Dieses besagt, dass im Voraus nicht vorhergesagt werden kann, ob das Programm einer Turing-Maschine jemals zu einem Ende kommt. \cite[S.70]{davis_computability_2013} Um die Funktionalität des Netzwerks zu gewährleisten, wird die Laufzeit einer jeden Zustandsveränderung der Blockchain, sprich Transaktion, durch Gas begrenzt.

Gas ist eine eigenständige Währung innerhalb von Ethereum, dessen Einheit einen Rechenschritt in der EVM bemisst \cite[S. 9:3]{m.spain_oasics-tokeneconomics_2019}, wobei für jeden Opcode die Kosten in Gas spezifiziert werden. \cite[S. 25 ff.]{wood_ethereum/yellowpaper_2019} Gas ist also eine Gebühr für Rechnenaufwand. Zusätzlich werden auch Kosten für die Nutzung von persistentem Speicher miteinbezogen. Es gilt sogar das Inverse: Wird durch eine Transaktion persistenter Speicher freigegeben, werden Rabatte gewährt.

Die maximale Gebühr einer Transaktion wird durch die Kombination der Datenfelder \textit{gasPrice} und \textit{gasLimit} angegeben. Die resultierende Gebühr $ \text{\textit{gasPrice}} \times \text{\textit{gasLimit}} $ wird bei Erstellung der Transaktion in voller Höhe vom Konto abgezogen. Nach Bestätigung der Transaktion wird nicht genutztes Gas zu dem angegebenen Preis in Ethereum zurückerstattet.

Somit gilt es im Voraus abzuschätzen wie hoch der Rechenaufwand sein wird. Je mehr Ressourcen des Weltcomputers in Anspruch genommen werden, desto höher die Gebühr. Gerade wegen des Halteproblems kann dies aber nur grob vorgenommen werden, eine robuste Programmierung von \textit{Smart Contracts} ist essentiell. Ein erster Anhaltepunkt dafür sind zunächst die intrinsischen Kosten einer Transaktion. Das ist der Overhead der allein durch die Transaktion und deren Inhalt betsteht. Diese intrinsischen Kosten $ g_0 $ lassen sich mit auf Basis folgender Grundlage berechnen.
$$ g_0 \equiv \sum_{i \in T_i, T_d}
  \begin{cases}
    G_{datazero} \text{ if } i=0 \\
    G_{txdatanonzero} \text{ otherwise}
  \end{cases}
  +
  \begin{cases}
    G_{txcreate} \text{ if } T_t = \emptyset \\
    0 \text{ otherwise}
  \end{cases}
  +
  G_{transaction}
$$
Also steigen die Kosten einer Transaktion mit der Größe des Feldes \textit{data} an und $ G_{transaction} $ bestimmt den Basiswert an Gas für eine Transaktion, welcher sich im Jahr 2020 auf 21000 beläuft. Generell sollte das \textit{gasLimit} tendenziell zu hoch angelegt sein, da Transaktionen mit unzureichendem Gas einfach abgebrochen werden \textit{(out-of-gas Exception)}. In diesem Fall wird keine der begonnenen Veränderungen am Zustand gespeichert.

\subsubsection{Preis und Latenz}
Gas kann bewusst nur mit Ether erworben werden, da die Gas-Preise möglichst unabhändig von den Preisschwankungen (von Ether) sein sollen. Der \textit{gasPrice} kann frei gesetzt werden, auch ein Wert von 0 ist gültig. Ein Richtwert für den Wert lässt sich durch Werkzeuge wie \href{https://www.ethgasstation.info/}{ETH Gas Station} ermitteln, welche vergangene Transaktionen im \textit{Ledger} betrachten und daraus Richtwerte ermitteln.

Dort wird auch ein Umstand kenntlich, denn die Höhe des Gas-Preises scheint maßgeblich über die Latenz zu entscheiden, also die Zeit bzw. Zahl der Blöcke zwischen Veroeffentlichung einer Transaktion und ihrer Inkludierung in einem Block. Übersteigt der \textit{gasPrice} das Mittel der anderen Transaktionen im \textit{mempool} so steigt die Wahrscheinlichkeit in nächsten Block bearbeitet zu werden. Diese Korrelation schwindet allerdings, sobald die Durchsatzfähigkeit des Netzwerkes erreicht ist. Unter Betrachtung aller Transaktionen im Zeitraum vom 01.03.2020 00:00:17 UTC (Block 9581792) bis 31.03.2020 23:59:57 UTC (Block 9782601) mit dem Python Werkzeug \textit{ethereum-etl} \cite{noauthor_blockchain-etl/ethereum-etl_2020} ergibt sich aktuell folgender Durchsatz $ T_{max} $ pro Block: \cite{neemann_appendix_nodate}
$$
  T_{max} = \frac{\textit{blockGasLimit}}{\textit{transactionMedianGas}} = \frac{9817880}{80000} = 122.72
$$
Bei kurzzeitig stark erhöhter Anzahl an Transaktionen wie beispielsweise bei einem \textit{ICO}, werden teilweise um ein vielfaches höhere Transaktionskosten gezahlt, um möglichst schnellen Zugriff auf die Wertanlagen zu erhalten. \cite[S. 9:6 f.]{m.spain_oasics-tokeneconomics_2019} Da das \textit{gasLimit} $ H_1 $ eines Blocks nur durch die Miner nach erfolgreichem Schürfen eines Blockes das alte Limit um maximal $ P(H)_{H1} $ um $ \frac{P(H)_{H1}}{1024} $ erhöht oder verringert werden. Dies soll eine Zentralisierung der Rechenleistung auf weniger Miner verhindern. Gleichzeitig limitiert dies die Fähigkeit viele Transaktionen in einem kurzen Zeitintervall zu verarbeiten.
\begin{figure}
  \includegraphics[width=\textwidth, keepaspectratio]{transactions_gasprice_timeseries.png}
  \caption{gasPrice nach Tag im Monat März \cite{neemann_appendix_nodate}}
  \label{transactions_gasprice_timeseries}
\end{figure}
Es zeigt sich außerdem, dass sich
\begin{figure}
  \includegraphics[width=\textwidth, keepaspectratio]{blocks_transactions_per_block.png}
  \caption{Verteilung der Zahl an Transaktionen pro Block \cite{neemann_appendix_nodate}}
  \label{blocks_transactions_per_block}
\end{figure}
\subsubsection{Anreiz und Spieletheorie}

\subsection{Value und Data}

\subsection{Signatur}

\subsubsection{ECDSA}
\label{ecdsa}

\subsubsection{Multisignaturen}

\section{Transaktionsabwicklung}

\subsection{Propagation}

\subsection{Speicherung}
% receipt

\section{Ausblick}

% Literatur
\bibliographystyle{splncs04.bst}
\bibliography{paper.bib}

\end{document}

